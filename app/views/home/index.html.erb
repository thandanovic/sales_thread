<% if user_signed_in? %>
  <%# Page Header %>
  <%= render "shared/components/page_header",
      title: "Dashboard",
      subtitle: "Welcome back, #{current_user.email.split('@').first}",
      actions: capture {
        link_to new_shop_path, class: "inline-flex items-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-dark transition-colors" do
          raw('<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>')
          concat "New Shop"
        end
      } %>

  <%# Stats Grid %>
  <div class="mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4">
    <%= render "shared/components/stat_card",
        title: "Total Shops",
        value: @shops.count,
        icon: "shop",
        color: "primary",
        link_path: shops_path,
        link_text: "View all shops" %>

    <% total_products = @shops.sum { |s| s.products.count } %>
    <%= render "shared/components/stat_card",
        title: "Total Products",
        value: total_products,
        icon: "box",
        color: "success" %>

    <% total_imports = @recent_imports&.count || 0 %>
    <%= render "shared/components/stat_card",
        title: "Recent Imports",
        value: total_imports,
        icon: "upload",
        color: "info" %>

    <% total_templates = @shops.sum { |s| s.olx_category_templates.count rescue 0 } %>
    <%= render "shared/components/stat_card",
        title: "OLX Templates",
        value: total_templates,
        icon: "template",
        color: "warning" %>
  </div>

  <%# Main Content Grid %>
  <div class="grid grid-cols-1 gap-6 xl:grid-cols-2">
    <%# Your Shops %>
    <%= render "shared/components/card", title: "Your Shops", padding: false do %>
      <% if @shops.any? %>
        <ul class="divide-y divide-gray-200 dark:divide-strokedark">
          <% @shops.limit(5).each do |shop| %>
            <li class="group">
              <%= link_to shop_path(shop), class: "flex items-center justify-between px-6 py-4 hover:bg-gray-50 dark:hover:bg-strokedark transition-colors" do %>
                <div class="flex items-center gap-4">
                  <div class="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10">
                    <svg class="h-5 w-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900 dark:text-white group-hover:text-primary">
                      <%= shop.name %>
                    </p>
                    <p class="text-sm text-gray-500 dark:text-bodydark2">
                      Created <%= time_ago_in_words(shop.created_at) %> ago
                    </p>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <%= render "shared/components/badge", text: "#{shop.products.count} products", type: "success", dot: false %>
                  <svg class="h-5 w-5 text-gray-400 group-hover:text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
              <% end %>
            </li>
          <% end %>
        </ul>

        <% if @shops.count > 5 %>
          <div class="border-t border-gray-200 dark:border-strokedark px-6 py-4">
            <%= link_to shops_path, class: "text-sm font-medium text-primary hover:text-primary-dark inline-flex items-center gap-1" do %>
              View all <%= @shops.count %> shops
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="px-6 py-12 text-center">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No shops yet</h3>
          <p class="mt-2 text-sm text-gray-500 dark:text-bodydark2">
            Get started by creating your first shop.
          </p>
          <div class="mt-6">
            <%= link_to new_shop_path, class: "inline-flex items-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-dark" do %>
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Create Shop
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>

    <%# Recent Imports %>
    <%= render "shared/components/card", title: "Recent Imports", padding: false do %>
      <% if @recent_imports && @recent_imports.any? %>
        <ul class="divide-y divide-gray-200 dark:divide-strokedark">
          <% @recent_imports.limit(5).each do |import| %>
            <li class="group">
              <%= link_to shop_import_path(import.shop, import), class: "flex items-center justify-between px-6 py-4 hover:bg-gray-50 dark:hover:bg-strokedark transition-colors" do %>
                <div class="flex items-center gap-4">
                  <div class="flex h-10 w-10 items-center justify-center rounded-full bg-info/10">
                    <svg class="h-5 w-5 text-info" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900 dark:text-white group-hover:text-primary">
                      <%= import.shop.name %>
                    </p>
                    <p class="text-sm text-gray-500 dark:text-bodydark2">
                      <%= import.source.humanize %> &bull; <%= time_ago_in_words(import.created_at) %> ago
                    </p>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <%
                    status_type = case import.status
                      when 'completed' then 'success'
                      when 'processing' then 'info'
                      when 'failed' then 'danger'
                      else 'default'
                    end
                  %>
                  <%= render "shared/components/badge", text: import.status.humanize, type: status_type %>
                </div>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <div class="px-6 py-12 text-center">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No imports yet</h3>
          <p class="mt-2 text-sm text-gray-500 dark:text-bodydark2">
            Import products to get started.
          </p>
        </div>
      <% end %>
    <% end %>
  </div>
<% else %>
  <%# Landing page for non-authenticated users %>
  <div class="text-center py-12">
    <div class="flex justify-center mb-6">
      <div class="h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center">
        <svg class="h-10 w-10 text-primary" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
      </div>
    </div>
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">Welcome to SLX.ba</h1>
    <p class="text-lg text-gray-600 dark:text-bodydark2 mb-8 max-w-2xl mx-auto">
      Manage your products with ease. Publish to OLX marketplace automatically.
    </p>
    <%= link_to new_user_session_path, class: "inline-flex items-center gap-2 rounded-lg bg-primary px-8 py-3 text-base font-medium text-white hover:bg-primary-dark transition-colors" do %>
      Sign in to get started
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
      </svg>
    <% end %>
  </div>
<% end %>
