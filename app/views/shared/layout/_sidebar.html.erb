<%# TailAdmin-style Sidebar Navigation %>
<aside
  data-sidebar-target="sidebar"
  class="fixed left-0 top-0 z-50 flex h-screen w-72 flex-col overflow-y-hidden bg-sidebar duration-300 ease-linear -translate-x-full lg:translate-x-0 lg:w-72 sidebar-expanded"
>
  <%# Logo Section %>
  <div class="flex items-center justify-between gap-2 px-6 py-5 lg:py-6">
    <%= link_to root_path, class: "flex items-center gap-2 min-w-0" do %>
      <%# Icon only (shown when collapsed) %>
      <svg class="h-8 w-8 flex-shrink-0" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="slxGradientSidebar" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#3C50E0;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#007BFF;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#00C6FF;stop-opacity:1" />
          </linearGradient>
        </defs>
        <%# Center circle %>
        <circle cx="50" cy="50" r="10" fill="#FFFFFF" />
        <%# Arrow lines from center to corners %>
        <line x1="42" y1="42" x2="20" y2="20" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" />
        <line x1="58" y1="42" x2="80" y2="20" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" />
        <line x1="58" y1="58" x2="80" y2="80" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" />
        <line x1="42" y1="58" x2="20" y2="80" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" />
        <%# Arrowheads - top left %>
        <polyline points="20,32 20,20 32,20" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        <%# Arrowheads - top right %>
        <polyline points="68,20 80,20 80,32" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        <%# Arrowheads - bottom right %>
        <polyline points="80,68 80,80 68,80" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        <%# Arrowheads - bottom left %>
        <polyline points="32,80 20,80 20,68" stroke="url(#slxGradientSidebar)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
      </svg>
      <%# Full text logo (hidden when collapsed) %>
      <span class="sidebar-text text-xl font-bold truncate">
        <span class="text-white">SLX</span><span class="text-primary">.ba</span>
      </span>
    <% end %>

    <%# Close button (mobile only) %>
    <button
      data-action="click->sidebar#closeMobile"
      class="block lg:hidden text-bodydark hover:text-white"
    >
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <%# Navigation %>
  <div class="no-scrollbar flex flex-col overflow-y-auto duration-300 ease-linear">
    <nav class="mt-1 px-4 lg:px-6">
      <%# Menu Group: Main - Only show for admins or users with multiple shops %>
      <% show_main_menu = current_user&.system_admin? || current_user&.memberships&.count.to_i > 1 %>
      <% if show_main_menu %>
        <div>
          <h3 class="mb-4 ml-4 text-xs font-medium uppercase tracking-wider text-bodydark2 sidebar-text">Menu</h3>

          <ul class="mb-6 flex flex-col gap-1">
            <%# Dashboard - only for admins %>
            <% if current_user&.system_admin? %>
              <li>
                <%= link_to root_path, class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{current_page?(root_path) ? 'bg-sidebar-active' : ''}" do %>
                  <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                  </svg>
                  <span class="sidebar-text">Dashboard</span>
                <% end %>
              </li>
            <% end %>

            <%# Shops - only for admins or users with multiple shops %>
            <li>
              <%= link_to shops_path, class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_name == 'shops' && action_name == 'index' ? 'bg-sidebar-active' : ''}" do %>
                <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                <span class="sidebar-text">Shops</span>
              <% end %>
            </li>
          </ul>
        </div>
      <% end %>

      <% if defined?(@shop) && @shop.present? && @shop.persisted? %>
        <% current_membership = @shop.membership_for(current_user) %>
        <% can_manage = current_user&.system_admin? || current_membership&.manager? %>
        <%# Shop-specific Menu %>
        <div>
          <h3 class="mb-4 ml-4 text-xs font-medium uppercase tracking-wider text-bodydark2 sidebar-text">
            <%= @shop.name&.truncate(18) || "New Shop" %>
          </h3>

          <ul class="mb-6 flex flex-col gap-1">
            <%# Shop Overview %>
            <li>
              <%= link_to shop_path(@shop), class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_name == 'shops' && action_name == 'show' ? 'bg-sidebar-active' : ''}" do %>
                <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="sidebar-text">Overview</span>
              <% end %>
            </li>

            <%# Products - visible to all members %>
            <li>
              <%= link_to shop_products_path(@shop), class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_name == 'products' ? 'bg-sidebar-active' : ''}" do %>
                <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
                <span class="sidebar-text">Products</span>
                <span class="sidebar-text absolute right-4 rounded bg-primary-light/30 px-1.5 py-0.5 text-xs font-medium text-primary-light">
                  <%= @shop.products.count %>
                </span>
              <% end %>
            </li>

            <% if can_manage %>
              <%# Imports - only visible to managers and admins %>
              <li>
                <%= link_to shop_imports_path(@shop), class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_name == 'imports' ? 'bg-sidebar-active' : ''}" do %>
                  <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                  </svg>
                  <span class="sidebar-text">Imports</span>
                <% end %>
              </li>

              <%# OLX Templates - only visible to managers and admins %>
              <li>
                <%= link_to shop_olx_category_templates_path(@shop), class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_name == 'olx_category_templates' ? 'bg-sidebar-active' : ''}" do %>
                  <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                  </svg>
                  <span class="sidebar-text">OLX Templates</span>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% if current_user&.system_admin? %>
        <%# Admin Menu - only visible to system admins %>
        <div>
          <h3 class="mb-4 ml-4 text-xs font-medium uppercase tracking-wider text-bodydark2 sidebar-text">Admin</h3>

          <ul class="mb-6 flex flex-col gap-1">
            <%# User Management %>
            <li>
              <%= link_to admin_users_path, class: "sidebar-link group relative flex items-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover #{controller_path == 'admin/users' ? 'bg-sidebar-active' : ''}" do %>
                <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <span class="sidebar-text">User Management</span>
              <% end %>
            </li>
          </ul>
        </div>
      <% end %>
    </nav>
  </div>

  <%# Collapse Toggle (desktop only) %>
  <div class="mt-auto hidden lg:block border-t border-strokedark px-4 py-4">
    <button
      data-action="click->sidebar#toggle"
      class="sidebar-link flex w-full items-center justify-center gap-2.5 rounded-md px-4 py-2 text-sm font-medium text-bodydark1 duration-300 ease-in-out hover:bg-sidebar-hover"
    >
      <svg data-sidebar-target="collapseIcon" class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
      </svg>
      <svg data-sidebar-target="expandIcon" class="h-5 w-5 flex-shrink-0 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
      </svg>
      <span class="sidebar-text">Collapse</span>
    </button>
  </div>
</aside>

<%# Mobile Overlay %>
<div
  data-sidebar-target="overlay"
  data-action="click->sidebar#closeMobile"
  class="fixed inset-0 z-40 bg-black/50 hidden lg:hidden"
></div>
