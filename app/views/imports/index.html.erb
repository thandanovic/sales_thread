<%# Page Header %>
<%= render "shared/components/page_header",
    title: "Import History",
    subtitle: "#{@shop.name} - View all product imports",
    actions: capture {
      concat link_to(shop_path(@shop), class: "inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-strokedark dark:bg-boxdark dark:text-bodydark1 dark:hover:bg-strokedark transition-colors") {
        raw('<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>') +
        "Back to Shop"
      }

      concat " "

      concat link_to(new_shop_import_path(@shop), class: "inline-flex items-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-dark transition-colors") {
        raw('<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>') +
        "New Import"
      }
    } %>

<% if @imports.any? %>
  <%= render "shared/components/card", padding: false do %>
    <div class="overflow-x-auto">
      <table class="w-full table-auto">
        <thead>
          <tr class="bg-gray-50 text-left dark:bg-strokedark">
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2">Source</th>
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2">Status</th>
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2">Results</th>
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2">Started</th>
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2">Completed</th>
            <th class="px-6 py-4 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-bodydark2"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-strokedark">
          <% @imports.each do |import| %>
            <tr class="hover:bg-gray-50 dark:hover:bg-strokedark transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <% if import.source == 'intercars' %>
                  <%= render "shared/components/badge", text: "Intercars", type: "info" %>
                <% elsif import.source == 'olx' %>
                  <%= render "shared/components/badge", text: "OLX Sync", type: "success" %>
                <% else %>
                  <%= render "shared/components/badge", text: (import.source&.upcase || 'CSV'), type: "default" %>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <% case import.status %>
                <% when 'completed' %>
                  <%= render "shared/components/badge", text: "Completed", type: "success" %>
                <% when 'completed_with_errors' %>
                  <%= render "shared/components/badge", text: "With Errors", type: "warning" %>
                <% when 'processing' %>
                  <%= render "shared/components/badge", text: "Processing", type: "info" %>
                <% when 'failed' %>
                  <%= render "shared/components/badge", text: "Failed", type: "danger" %>
                <% else %>
                  <%= render "shared/components/badge", text: (import.status&.humanize || 'Pending'), type: "default" %>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <% if import.total_rows && import.total_rows > 0 %>
                  <div class="text-sm font-medium text-success"><%= import.successful_rows || 0 %> / <%= import.total_rows %></div>
                  <% if import.failed_rows && import.failed_rows > 0 %>
                    <div class="text-xs text-danger"><%= import.failed_rows %> failed</div>
                  <% end %>
                <% else %>
                  <span class="text-sm text-gray-400 dark:text-bodydark2">-</span>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-bodydark2">
                <%= import.started_at&.strftime('%b %d, %Y %H:%M') || '-' %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-bodydark2">
                <%= import.completed_at&.strftime('%b %d, %Y %H:%M') || '-' %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right">
                <%= link_to shop_import_path(@shop, import), class: "inline-flex items-center gap-1 text-sm font-medium text-primary hover:text-primary-dark" do %>
                  View
                  <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="px-6 py-4 border-t border-gray-200 dark:border-strokedark">
      <%= paginate @imports %>
    </div>
  <% end %>
<% else %>
  <%= render "shared/components/card" do %>
    <div class="py-12 text-center">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No imports yet</h3>
      <p class="mt-2 text-sm text-gray-500 dark:text-bodydark2">Get started by importing products from CSV or Intercars.</p>
      <div class="mt-6">
        <%= link_to new_shop_import_path(@shop), class: "inline-flex items-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-dark transition-colors" do %>
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          New Import
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
