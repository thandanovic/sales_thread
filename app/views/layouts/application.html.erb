<!DOCTYPE html>
<html class="<%= cookies[:dark_mode] == 'true' ? 'dark' : '' %>">
  <head>
    <title><%= content_for(:title) || "SLX.ba" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.svg">

    <%# Includes Tailwind CSS %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <%# SlimSelect for searchable dropdowns %>
    <link href="https://cdn.jsdelivr.net/npm/slim-select@2.8.2/dist/slimselect.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/slim-select@2.8.2/dist/slimselect.min.js"></script>

    <%# SlimSelect custom styles (must load after CDN) %>
    <style>
      /* SlimSelect Custom Styles to match regular select (py-2.5 = 10px padding) */
      .ss-main {
        border: 1px solid #d1d5db !important;
        border-radius: 0.5rem !important;
        background-color: white !important;
        min-height: 42px !important;
        height: 42px !important;
        font-size: 0.875rem !important;
        padding: 0 !important;
      }

      .ss-main:focus,
      .ss-main.ss-open-below,
      .ss-main.ss-open-above {
        outline: none !important;
        border-color: #3C50E0 !important;
        box-shadow: 0 0 0 1px #3C50E0 !important;
      }

      .ss-main .ss-single-selected,
      .ss-main .ss-multi-selected {
        border: none !important;
        background-color: transparent !important;
        min-height: 40px !important;
        height: 40px !important;
        padding: 0 1rem !important;
        display: flex !important;
        align-items: center !important;
      }

      .ss-main .ss-values {
        display: flex !important;
        align-items: center !important;
        height: 100% !important;
      }

      .ss-main .ss-values .ss-single {
        margin: 0 !important;
        padding: 0 0.25rem !important;
        line-height: 1.25 !important;
      }

      .ss-main .ss-arrow {
        margin-right: 0.5rem !important;
      }

      .ss-main .ss-deselect {
        margin-right: 0.25rem !important;
      }

      .ss-content {
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        margin-top: 4px;
      }

      .ss-content .ss-search {
        padding: 0.75rem;
      }

      .ss-content .ss-search input {
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
      }

      .ss-content .ss-search input:focus {
        outline: none;
        border-color: #3C50E0;
        box-shadow: 0 0 0 1px #3C50E0;
      }

      .ss-content .ss-list .ss-option {
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
      }

      .ss-content .ss-list .ss-option:hover {
        background-color: #f3f4f6;
      }

      .ss-content .ss-list .ss-option.ss-highlighted,
      .ss-content .ss-list .ss-option.ss-selected {
        background-color: #3C50E0;
        color: white;
      }

      /* SlimSelect Dark Mode */
      .dark .ss-main {
        background-color: #24303F !important;
        border-color: #2E3A47 !important;
        color: #DEE4EE !important;
      }

      .dark .ss-main .ss-single-selected .ss-placeholder {
        color: #8A99AF !important;
      }

      .dark .ss-main .ss-values .ss-single {
        color: #DEE4EE !important;
      }

      .dark .ss-content {
        background-color: #24303F;
        border-color: #2E3A47;
      }

      .dark .ss-content .ss-search input {
        background-color: #1A222C;
        border-color: #2E3A47;
        color: #DEE4EE;
      }

      .dark .ss-content .ss-search input::placeholder {
        color: #8A99AF;
      }

      .dark .ss-content .ss-list .ss-option {
        color: #DEE4EE;
      }

      .dark .ss-content .ss-list .ss-option:hover {
        background-color: #2E3A47;
      }

      .dark .ss-content .ss-list .ss-option.ss-highlighted,
      .dark .ss-content .ss-list .ss-option.ss-selected {
        background-color: #5B6CF4;
        color: white;
      }

      /* Hide original select when SlimSelect is active */
      select[data-controller="slim-select"] {
        display: none;
      }
    </style>

    <%= javascript_importmap_tags %>

    <%# Prevent flash of wrong theme %>
    <script>
      (function() {
        const theme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (theme === 'dark' || (!theme && prefersDark)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="font-sans antialiased bg-whiten text-gray-900 dark:bg-boxdark-2 dark:text-bodydark">
    <% if user_signed_in? %>
      <%# Dashboard Layout with Sidebar %>
      <div class="flex h-screen overflow-hidden" data-controller="sidebar">
        <%# Sidebar %>
        <%= render "shared/layout/sidebar" %>

        <%# Main Content Area %>
        <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden lg:ml-72 page-transition">
          <%# Header %>
          <%= render "shared/layout/header" %>

          <%# Main Content %>
          <main class="mx-auto w-full max-w-screen-2xl p-4 md:p-6 2xl:p-10">
            <%# Flash Messages %>
            <% if notice.present? %>
              <%= render "shared/components/alert", type: "success", message: notice %>
            <% end %>
            <% if alert.present? %>
              <%= render "shared/components/alert", type: "error", message: alert %>
            <% end %>

            <%= yield %>
          </main>
        </div>
      </div>
    <% else %>
      <%# Auth Layout (no sidebar) %>
      <div class="flex min-h-screen items-center justify-center bg-whiten dark:bg-boxdark-2 px-4 py-12">
        <div class="w-full max-w-md">
          <%# Logo %>
          <div class="mb-8 text-center">
            <%= link_to root_path, class: "inline-flex flex-col items-center gap-3" do %>
              <svg class="h-16 w-16" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <linearGradient id="slxGradientAuth" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#3C50E0;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#007BFF;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#00C6FF;stop-opacity:1" />
                  </linearGradient>
                </defs>
                <circle cx="50" cy="50" r="10" fill="#3C50E0" />
                <line x1="42" y1="42" x2="20" y2="20" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" />
                <line x1="58" y1="42" x2="80" y2="20" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" />
                <line x1="58" y1="58" x2="80" y2="80" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" />
                <line x1="42" y1="58" x2="20" y2="80" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" />
                <polyline points="20,32 20,20 32,20" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <polyline points="68,20 80,20 80,32" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <polyline points="80,68 80,80 68,80" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <polyline points="32,80 20,80 20,68" stroke="url(#slxGradientAuth)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
              </svg>
              <div class="flex flex-col items-center">
                <span class="text-3xl font-extrabold">
                  <span class="text-gray-900 dark:text-white">SLX</span><span class="text-primary">.ba</span>
                </span>
                <span class="text-xs text-gray-500 dark:text-bodydark tracking-wider mt-1">SALE EXTREMELY. DISTRIBUTED.</span>
              </div>
            <% end %>
          </div>

          <%# Flash Messages %>
          <% if notice.present? %>
            <%= render "shared/components/alert", type: "success", message: notice %>
          <% end %>
          <% if alert.present? %>
            <%= render "shared/components/alert", type: "error", message: alert %>
          <% end %>

          <%# Auth Card %>
          <div class="rounded-xl border border-gray-200 bg-white p-8 shadow-default dark:border-strokedark dark:bg-boxdark">
            <%= yield %>
          </div>
        </div>
      </div>
    <% end %>
  </body>
</html>
